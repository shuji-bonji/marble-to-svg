# 網羅的なMarble Diagrams例

以下に、RxJSのTestSchedulerで使用できる様々なMarble diagramsの例を列挙します。これらは「マーブル記法 → SVGジェネレーター」のテストケースとしても活用できます。

## 基本的なダイアグラム

### 単純な値の発行

```ts
// 基本的な値の発行と完了
'---a---b---|'
// マッピング: { a: 'Hello', b: 'World' }
```

### エラーを含むダイアグラム

```ts
// 値を発行した後にエラー
'---a---b---#'
// マッピング: { a: 1, b: 2 }, エラー: new Error('エラーが発生しました')
```

### 値の同時発行

```ts
// 複数の値を同時に発行
'---(abc)---|'
// マッピング: { a: 1, b: 2, c: 3 }
```

### 遅延して完了

```ts
// 値の発行後、しばらく経ってから完了
'---a---b------------|'
```

### 空のObservable

```ts
// 何も発行せずに完了
'--|'
```

### 無限のObservable

```ts
// 完了しないObservable
'---a---b---c---'
```

## Hot Observableの例

### 購読開始点がある例

```ts
// ^はSubscribe開始点を表す
'-a-^-b---c---|'
// ^より前のイベントは無視される
```

### 購読終了点がある例

```ts
// !はUnsubscribe点を表す
'-a-^-b---c---!---|'
// !以降のイベントは無視される
```

## 複雑なダイアグラム

### 不規則な間隔での発行

```ts
'--a----b--c-------d--|'
```

### グループ化された同時発行を含む例

```ts
'--a--(bc)-----(de)--|'
```

### 空文字との組み合わせ

```ts
'---a---b--- ---|'
// スペースは無視される
```

### 複数グループの例

```ts
'---(abc)---(def)---|'
```

### エラーと同時発行の組み合わせ

```ts
'---(abc)---#'
```

## オペレーターのテストに有用な例

### マージの例

```ts
// source1: ---a---b---|
// source2: -----c---d---|
// 期待値:  ---a-c-b-d---|
```

### フィルターの例

```ts
// source:  ---a---b---c---|
// filter:  偶数のみ通過（b=2のみ通過）
// 期待値:  -------b-------|
```

### マップの例

```ts
// source:  ---a---b---|
// map:     各値を2倍
// 期待値:  ---x---y---|
// マッピング: { x: 2, y: 4 }（元のa=1, b=2と仮定）
```

### コンキャットの例

```ts
// source1: ---a---b---|
// source2: (source1の後に実行) ---c---d---|
// 期待値:  ---a---b------c---d---|
```

### デバウンスの例

```ts
// source:  --a--b-c--------d--|
// debounce: 20ms
// 期待値:  --------c---------d--|
```

### 再試行の例

```ts
// source:  ---a---#
// retry(2)
// 期待値:  ---a------a---#
```

## 特殊なケース

### 連続同時発行の例

```ts
// 一連の同時発行が連続する
'---(abc)---(def)---(ghi)--|'
```

### 最初のフレームでの同時発行

```ts
// 最初のフレームで同時発行
'(abc)---d---|'
```

### 完了直前の同時発行

```ts
// 完了直前に同時発行
'---a---(bc)|'
```

### エラー直前の同時発行

```ts
// エラー直前に同時発行
'---a---(bc)#'
```

### 購読解除直前の同時発行

```ts
'---^---(abc)!---|'
```

### 特殊文字を含む例

```ts
// 特殊文字をエスケープする必要がある場合
'---a---b---|'
// マッピング: { a: '{special}', b: '[chars]' }
```

## テスト用特殊ケース

### 非常に長いシーケンス

```ts
'----a----b----c----d----e----f----g----h----|'
```

### 非常に短いシーケンス

```ts
'a|'
```

### 1フレーム目での完了

```ts
'|'
```

### 1フレーム目でのエラー

```ts
'#'
```

### 複数のグループと完了が近接

```ts
'---(abc)---(def)|'
```

### 複数のグループとエラーが近接

```ts
'---(abc)---(def)#'
```

## 検証パターン

これらの例は、パースロジックとSVGレンダリングの両方をテストするのに役立ちます。実装時には以下の点に注意してください：

1. すべての特殊文字（`|`, `#`, `^`, `!`, `(`, `)`）が正しく処理されるか
2. グループ化された値が同じフレームに正しく配置されるか
3. 時間間隔が正確に表現されるか
4. Hot Observableの購読開始・終了が正しく表示されるか
5. エラーと完了の表示が明確か
6. 長いシーケンスと短いシーケンスの両方が適切にレンダリングされるか

これらの例を元に、パース関数とSVGレンダリング関数をテストすることで、堅牢なマーブルダイアグラムビジュアライゼーションツールを作成できるでしょう。
